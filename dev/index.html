<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="white">
  <title>mashgiach</title>
  
</head>
<link rel="manifest" href="../manifest.webmanifest">
<link rel="icon" type = "image/x-icon" href = "../src/assets/app_icon.svg">
<body>
  <script src="./index.js" type="module"></script>
  <!-- <script>
    document.addEventListener("DOMContentLoaded", function() {
  const cardElement = document.getElementById('open-card');
  if (!cardElement) {
      console.error('Card element with ID "open-card" not found.');
  }
  console.log("found card element {cardElement}");

  let startX;
  let endX;

  cardElement.addEventListener('touchstart', function(event) {
      startX = event.touches[0].clientX;
      console.log("startX {startX}");
  });

  cardElement.addEventListener('touchmove', function(event) {
      endX = event.touches[0].clientX;
      console.log("endX {endX}");
  });

  cardElement.addEventListener('touchend', function() {
      const diffX = startX - endX;
      if (diffX > 50) { // Swipe left detection threshold
          clearCard();
      }
  });

  function clearCard() {
      const backButton = document.getElementById('back-button');
      console.log("found back button {backButton}");
      if (!backButton) {
              console.error('Back button with ID "back-button" not found.');
          }
      if (backButton) {
          backButton.click(); // Simulate the back button click
      }
  }
});
  </script> -->
  <script>
    function init() {
      const cardElement = document.getElementById('open-card');
      const backButton = document.getElementById('back-button');
      
      if (!cardElement) {
        console.error('Card element with ID "open-card" not found.');
        return;
      }
      console.log("Found card element:", cardElement);

      if (!backButton) {
        console.error('Back button with ID "back-button" not found.');
        return;
      }
      console.log("Found back button:", backButton);

      let startX;
      let endX;

      // Touch events
      cardElement.addEventListener('touchstart', handleTouchStart);
      cardElement.addEventListener('touchmove', handleTouchMove);
      cardElement.addEventListener('touchend', handleTouchEnd);

      // Mouse events for desktop testing
      cardElement.addEventListener('mousedown', handleMouseDown);
      cardElement.addEventListener('mousemove', handleMouseMove);
      cardElement.addEventListener('mouseup', handleMouseUp);

      function handleTouchStart(event) {
        startX = event.touches[0].clientX;
        console.log("Touch start at X:", startX);
      }

      function handleTouchMove(event) {
        endX = event.touches[0].clientX;
        console.log("Touch move to X:", endX);
      }

      function handleTouchEnd() {
        const diffX = startX - endX;
        console.log("Touch end. Difference in X:", diffX);
        if (diffX > 50) { // Swipe left detection threshold
          console.log("Swipe detected. Clearing card.");
          clearCard();
        } else {
          console.log("Swipe not detected. Threshold not met.");
        }
      }

      function handleMouseDown(event) {
        startX = event.clientX;
        console.log("Mouse down at X:", startX);
      }

      function handleMouseMove(event) {
        if (startX !== undefined) {
          endX = event.clientX;
          console.log("Mouse move to X:", endX);
        }
      }

      function handleMouseUp() {
        if (startX !== undefined && endX !== undefined) {
          const diffX = startX - endX;
          console.log("Mouse up. Difference in X:", diffX);
          if (diffX > 50) { // Swipe left detection threshold
            console.log("Swipe detected. Clearing card.");
            clearCard();
          } else {
            console.log("Swipe not detected. Threshold not met.");
          }
          startX = undefined;
          endX = undefined;
        }
      }

      function clearCard() {
        console.log("Attempting to clear card");
        if (backButton) {
          backButton.click(); // Simulate the back button click
          console.log('Back button clicked.');
        } else {
          console.error('Back button not found at the time of clearing.');
        }
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      // Retry mechanism to ensure the element is loaded
      let attempts = 0;
      const maxAttempts = 10;
      const interval = setInterval(function() {
        const cardElement = document.getElementById('open-card');
        if (cardElement) {
          clearInterval(interval);
          init(); // Initialize the event listeners
        } else if (attempts >= maxAttempts) {
          clearInterval(interval);
          console.error('Card element not found after multiple attempts.');
        }
        attempts++;
      }, 100); // Check every 100ms
    });
  </script>
  <script>
    const sw = "service-worker.js"; // it is needed because parcel will not recognize this as a file and not precess in its manner

navigator.serviceWorker
  .register(sw)
  .then(registration => {
    registration.onupdatefound = () => {
      const installingWorker = registration.installing;
      if (installingWorker == null) {
        return;
      }
      installingWorker.onstatechange = () => {
        if (installingWorker.state === "installed") {
          if (navigator.serviceWorker.controller) {
            console.log(
              "New content is available and will be used when all " +
                "tabs for this page are closed. See https://bit.ly/CRA-PWA."
            );
          } else {
            console.log("Content is cached for offline use.");
          }
        }
      };
    };
  })
  .catch(error => {
    console.error("Error during service worker registration:", error);
  });

  </script>
</body>

</html>